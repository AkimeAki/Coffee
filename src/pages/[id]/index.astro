---
import Layout from "@/layouts/Layout.astro";
import { formatDate } from "@/lib/format-date";
import { getContentsDetail, getListContents } from "@/lib/microcms";
import cheerio from "cheerio";
import type { Blog } from "@/lib/microcms";

interface pathType {
	params: {
		id: string;
	};
}

export const getStaticPaths = async (): Promise<pathType[]> => {
	const response = await getListContents<Blog>("blogs", { fields: ["id"] });
	return response.contents.map((content) => ({
		params: {
			id: content.id
		}
	}));
};

const { id } = Astro.params;
if (id === undefined) {
	return;
}

const blog = await getContentsDetail<Blog>("blogs", id);

const $ = cheerio.load(blog.contents);
const description = $.text();
---

<Layout title={blog.title} description={description}>
	<main id="main">
		<time class="post-date" datetime={blog.publishedAt ?? blog.createdAt}>
			{formatDate(blog.publishedAt ?? blog.createdAt)}
		</time>
		<h2 class="post-title">{blog.title}</h2>
		<div class="post-content" set:html={blog.contents} />
	</main>
	<div id="bg-image-wrapper">
		<img id="bg-image" src={`https://r2.aki.coffee/${blog.id}.png`} />
	</div>
</Layout>

<style lang="scss">
	html,
	body {
		width: 100%;
		height: 100%;
	}

	body {
		position: relative;
	}

	:global(#title) {
		color: white;
	}

	#bg-image-wrapper {
		position: fixed;
		top: 0;
		left: 0;
		width: 100%;
		height: 100%;
		z-index: -1;
		overflow: hidden;

		#bg-image {
			object-fit: cover;
			width: 100%;
			height: 100%;
			transform: scale(1.1);
			filter: blur(7px) brightness(45%);
		}
	}

	#main {
		width: 100%;
		max-width: 660px;
		margin: 0 auto;
		padding: 25px 25px 100px 25px;

		.post-title {
			font-size: 18px;
			margin-bottom: 50px;
			color: white;
		}

		.post-content {
			:global(p) {
				margin-bottom: 35px;
				font-size: 16px;
				color: white;

				&:last-child {
					margin-bottom: 0;
				}
			}
		}

		.post-date {
			font-size: 15px;
			margin-bottom: 40px;
			display: block;
			text-align: right;
			color: white;
		}

		.post-link {
			position: absolute;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
		}
	}
</style>

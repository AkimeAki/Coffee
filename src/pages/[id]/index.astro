---
import Layout from "@/layouts/Layout.astro";
import { formatDate } from "@/lib/format-date";
import { getContentsDetail, getListContents } from "@/lib/microcms";
import type { Blog } from "@/lib/microcms";

interface pathType {
	params: {
		id: string;
	};
}

export const getStaticPaths = async (): Promise<pathType[]> => {
	const response = await getListContents<Blog>("blogs", { fields: ["id"] });
	return response.contents.map((content) => ({
		params: {
			id: content.id
		}
	}));
};

const { id } = Astro.params;
if (id === undefined) {
	return;
}

const blog = await getContentsDetail<Blog>("blogs", id);
---

<Layout title={blog.title}>
	<main id="main">
		<time class="post-date" datetime={blog.publishedAt ?? blog.createdAt}>
			{formatDate(blog.publishedAt ?? blog.createdAt)}
		</time>
		<h2 class="post-title">{blog.title}</h2>
		<div class="post-content" set:html={blog.contents} />
	</main>
</Layout>

<style lang="scss">
	#main {
		padding: 0 20px;
		width: 100%;
		max-width: 660px;
		margin: 0 auto;
		padding: 25px;

		.post-title {
			font-size: 18px;
			margin-bottom: 50px;
		}

		.post-content {
			:global(p) {
				margin-bottom: 35px;
				font-size: 16px;

				&:last-child {
					margin-bottom: 0;
				}
			}
		}

		.post-date {
			font-size: 15px;
			margin-bottom: 40px;
			display: block;
			text-align: right;
		}

		.post-link {
			position: absolute;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
		}
	}
</style>
